---
layout: post
title: Cocktail, for an open bar community !
date: 2011-09-07 15:55:45.000000000 +02:00
type: post
parent_id: '0'
published: true
password: ''
status: publish
categories:
- Blog Labs
- Blog Silex Labs
- The Blog
tags:
- cocktail
- cross-platform
- demo
- flash
- Haxe
- html5
- javaScript
- js
- library
- php
meta:
  _edit_last: '15'
  _syntaxhighlighter_encoded: '1'
  _itemCurrentVersion: ''
  _epLastError: ''
  _epLastMessage: ''
  wpautop: "- Select -"
  skin: "- Select -"
  layout_footer: "- Select -"
  layout: "- Select -"
  layout_header: "- Select -"
author:
  login: lexa
  email: lexoyo@yahoo.com
  display_name: lexa
  first_name: lexa
  last_name: ''
permalink: "/cocktail-for-an-open-bar-community/"
---
<p><em><strong>Some parts of this article are now obsolete, as Cocktail has changed a lot (2012-08-14).</strong></em></p>
<p><span class="Apple-style-span" style="font-size: 20px; font-weight: bold;">Cocktail, what is cocktail?!</span></p>
<p><a title="Cocktail, cross-platform haXe" href="https://www.silexlabs.org/groups/labs/cocktail/">Cocktail is the name of a new project @ Silex Labs.</a></p>
<p><em>This is an article for developers about the haXe library Cocktail, cross platform haXe!</em></p>
<p><em>Please use up-to-date Firefox 6, Chrome or Safari, as there are still issues with other browsers.</em></p>
<p><img class="alignleft size-full wp-image-130372" title="cocktail-image" src="{{ site.baseurl }}/assets/cocktail-image.jpg" alt="" width="150" height="150" /></p>
<p>According to the website in <a title="The Labs of Silex Labs" href="https://www.silexlabs.org/labs/">The Labs</a>, Cocktail is <strong>a cross-platform library for the <a href="http://haxe.org/">haXe</a> programming language</strong>. It bridges the gap between all the targets supported by haXe, removing inconsistencies behind a common API. With it, <strong>the same code base is used to deploy to these targets: <strong>HTML5 + javaScript, </strong>Flash, PHP</strong>.</p>
<p>It helps <strong>multi device application development</strong> and should be used by haXe projects requiring cross-target compilation.</p>
<p>And of course, it is released under GPL.</p>
<p>In this alpha1 release, DOM manipulation basis are present, with assets loading, external libraries and native code includes, as well as drawing API. The text can be used, but the text style is not handled yet, so it may be different in js and Flash, as you can see it bellow.</p>
<p style="text-align: center;"><a href="https://www.silexlabs.org/?attachment_id=129494" rel="attachment wp-att-129494"><iframe style="border: 0pt none;" src="http://demos.silexlabs.org/cocktail/clock/clock_As3.html" marginwidth="0" marginheight="0" scrolling="no" width="200" height="200"></iframe><iframe style="border: 0pt none;" src="http://demos.silexlabs.org/cocktail/clock/clock_js.html" marginwidth="0" marginheight="0" scrolling="no" width="200" height="200"></iframe></a></p>
<address style="text-align: center;">Javascript and Flash version of the clock, try to guess which one is which :)</address>
<address style="text-align: center;">For now, the text styles are not handled yet, so it may appear different in js and Flash</address>
<address style="text-align: center;"> </address>
<p>In this article, we will see some demo of cross platform code, and focus on the Cocktail part of the sample code. The first example, the "clock" is very simple, we load png images and manipulate them to display the time it is. The "ski game" sample is a bit more complex, and uses a classic technique in games, where the game is drawn on a screen at each frame - the scree is a canvas in HTML, and a Sprite in Flash, but this is transparent with Cocktail.</p>
<address style="text-align: center;"><iframe style="border: 0pt none;" src="http://demos.silexlabs.org/cocktail/ski/ski.html" marginwidth="0" marginheight="0" scrolling="no" width="645" height="485"></iframe></address>
<address style="text-align: center;">press the space bar to play</address>
<address style="text-align: center;">guess what, this is not Flash !</address>
<address style="text-align: center;"> </address>
<p>Feel free to check the get started with <a href="http://haxe.org/com/libs/cocktail">Cocktail article on the haXe wiki</a> for more technical information and getting started with haXe article for more details about haXe.</p>
<p>Links</p>
<ul>
<li><a href="https://www.silexlabs.org/groups/labs/cocktail/">Project home</a></li>
<li><a title="road map and development status" href="https://github.com/silexlabs/Cocktail/wiki/Road-map">Cocktail road map and development state</a></li>
<li><a href="https://github.com/silexlabs/Cocktail">Cocktail source code</a></li>
<li><a href="https://www.silexlabs.org/groups/labs/cocktail/forum/">Forums</a></li>
<li><a href="http://haxe.org/com/libs/cocktail">Cocktail wiki on haXe.org</a></li>
</ul>
<div><strong><a href="https://www.silexlabs.org/the-blog/cocktail-for-an-open-bar-community/">Read the whole article if you want to see some code :)</a></strong></div>
<div>
<hr />
</div>
<div><!--more--></div>
<h2>Clock demo</h2>
<p>Here is a very basic demo, which displays an analog clock. The code is very simple and uses Cocktail library to load the background image and the clock hand image, and display it rotated, with its center as a register point.</p>
<h3>Flash version</h3>
<p>Requires Flash Player 10.2.<br />
<iframe style="border: 0pt none;" src="http://demos.silexlabs.org/cocktail/clock/clock_As3.html" marginwidth="0" marginheight="0" scrolling="no" width="200" height="200"></iframe></p>
<h3>javascript version</h3>
<p>Requires HTML5.<br />
<iframe style="border: 0pt none;" src="http://demos.silexlabs.org/cocktail/clock/clock_js.html" marginwidth="0" marginheight="0" scrolling="no" width="200" height="200"></iframe></p>
<h3>The code</h3>
<p>You can take look at the <a title="Cocktail demo, the clock example" href="https://github.com/SilexLabsThirdParty/Cocktail-legacy/blob/master/demo/clock/Clock.hx">code on github</a>, and you will see that there is <strong>NO conditional compilation at all</strong>, no #if js nor #if flash...</p>
<p>Here we will show the parts which use the Cocktail API.</p>
<h4>1st contact: the imports show some of the classes exposed by Cocktail</h4>
<p>[sourcecode language="actionscript3"]<br />
import cocktail.resource.ResourceLoaderManager;<br />
import cocktail.nativeElement.NativeElementManager;<br />
import cocktail.domElement.ImageDOMElement;<br />
import cocktail.domElement.TextDOMElement;<br />
[/sourcecode]</p>
<p>These classes will let you manipulate the javascript or Flash DOM seamlessly, load assets and get keyboard events. As you will see it below...</p>
<h4>The stage for the game</h4>
<p>The "stage" or the root graphical object of our game, will be the root clip in Flash and the body in HTML. Here is how it is declared:<span class="Apple-style-span" style="font-family: Consolas, Monaco, monospace; line-height: 18px; font-size: 12px; white-space: pre;"> </span></p>
<p>[sourcecode language="actionscript3"]<br />
/**<br />
 * The root of the dom (stage in flash, body in html)<br />
 */<br />
private static var rootDOMElement:DOMElement;<br />
[/sourcecode]</p>
<p>And initialized:</p>
<p>[sourcecode language="actionscript3"]<br />
rootDOMElement = new DOMElement(NativeElementManager.getRoot());<br />
[/sourcecode]</p>
<p>You can notice that the root clip is returned by NativeElementManager::getRoot. Its type is NativeElement, and it is used to create a DOMElement, which is the base type for all graphical objects in Cocktail. So, this instruction, creates a DOMElement which will be used as the root container of our application, it will represent the root Sprite in the Flash version, and the body element in HTML.</p>
<h4>The graphical objects</h4>
<p>Here are the variables used to store the graphical objects</p>
<p>[sourcecode language="actionscript3"]<br />
/**<br />
 * the background of the analogue clock<br />
 */<br />
private var _clockBackground:ImageDOMElement;</p>
<p>/**<br />
 * the foreground of the analogue clock<br />
 */<br />
private var _clockForeGround:ImageDOMElement;</p>
<p>/**<br />
 * the second needle of the clock<br />
 */<br />
private var _secondNeedle:ImageDOMElement;</p>
<p>/**<br />
 * the minute needle of the clock<br />
 */<br />
private var _minuteNeedle:ImageDOMElement;</p>
<p>/**<br />
 * the hour needle of the clock<br />
 */<br />
private var _hourNeedle:ImageDOMElement;</p>
<p>/**<br />
 * the numeric clock<br />
 */<br />
private var _clockDisplay:TextDOMElement;<br />
[/sourcecode]</p>
<h4 id="LC64"><span style="font-family: Georgia, 'Times New Roman', 'Bitstream Charter', Times, serif; font-size: small;"><span class="Apple-style-span" style="font-size: 13px; line-height: 19px; white-space: normal;">Manipulation of the DOM</span></span></h4>
<p><span class="Apple-style-span" style="font-family: Georgia, 'Times New Roman', 'Bitstream Charter', Times, serif; line-height: 19px; white-space: normal; font-size: 13px;">Here is the code where the graphical assets are loaded...</span></p>
<p>[sourcecode language="actionscript3"]<br />
ResourceLoaderManager.loadImage(&quot;assets/second_needle.png&quot;, onSecondNeedleLoaded, function(err){});<br />
ResourceLoaderManager.loadImage(&quot;assets/hour_needle.png&quot;, onHourNeedleLoaded, function(err){});<br />
ResourceLoaderManager.loadImage(&quot;assets/minute_needle.png&quot;, onMinuteNeedleLoaded, function(err){});<br />
ResourceLoaderManager.loadImage(&quot;assets/clock_background.png&quot;, onClockBackgroundLoaded, function(err){});<br />
ResourceLoaderManager.loadImage(&quot;assets/clock_foreground.png&quot;, onClockForegroundLoaded, function(err){});<br />
[/sourcecode]</p>
<p>... and then attached to the DOM</p>
<p>[sourcecode language="actionscript3"]<br />
rootDOMElement.addChild(_clockBackground);<br />
rootDOMElement.addChild(_secondNeedle);<br />
rootDOMElement.addChild(_minuteNeedle);<br />
rootDOMElement.addChild(_hourNeedle);<br />
rootDOMElement.addChild(_clockForeGround);<br />
[/sourcecode]</p>
<p>The rotation of the images is set in order to reflect the time it is</p>
<p>[sourcecode language="actionscript3"]<br />
_secondNeedle.rotation = Math.round(Date.now().getSeconds() * 6);<br />
_minuteNeedle.rotation = Math.round(Date.now().getMinutes() * 6);<br />
_hourNeedle.rotation = Math.round(Date.now().getHours() * (360/12));<br />
[/sourcecode]</p>
<p>You can notice how simple it is to rotate a DOMElement with setRotation, passing the angle as the 1st argument and the rotation center as a 2d argument.</p>
<h4>About the text</h4>
<p>The text in cocktail is also handled as a DOMElement. But in this alpha1 release, the text style is not handled yet, so it may not appear the same in js and Flash.</p>
<p>[sourcecode language="actionscript3"]<br />
_clockDisplay = new TextDOMElement();<br />
rootDOMElement.addChild(_clockDisplay);<br />
...<br />
_clockDisplay.text = Date.now().toString();<br />
[/sourcecode]</p>
<h2>Ski demo</h2>
<p>Here is <a href="http://gm2d.com/2009/02/simple-flash-game-in-haxe/">the classic little ski game</a> of <a href="http://gm2d.com/">GM2D</a>, which has modified to use Cocktail and compile in javascript and Flash with exactly the same code.</p>
<p>This example is interesting since it shows how to draw in a DOMElement, and how to use the keyboard events.</p>
<h3>Flash version</h3>
<p>Requires Flash Player 10.2. Exactly the same as the original version...<br />
<iframe style="border: 0pt none;" src="http://demos.silexlabs.org/cocktail/ski/ski_as3.html" marginwidth="0" marginheight="0" scrolling="no" width="640" height="480"></iframe></p>
<h3>javascript version</h3>
<p>Requires HTML5. Looks the same :)<br />
<iframe style="border: 0pt none;" src="http://demos.silexlabs.org/cocktail/ski/ski.html" marginwidth="0" marginheight="0" scrolling="no" width="645" height="485"></iframe></p>
<h3>The code</h3>
<p>You can take look at the <a title="Cocktail demo, the ski game" href="https://github.com/SilexLabsThirdParty/Cocktail-legacy/blob/master/demo/ski/Ski.hx">code on github</a>, and you will see that there is <strong>NO conditional compilation at all</strong>, no #if js nor #if flash...</p>
<p>Here we will show the parts which use the Cocktail API.</p>
<h4>The main classes</h4>
<p>[sourcecode language="actionscript3"]<br />
import cocktail.resource.ResourceLoaderManager;<br />
import cocktail.nativeElement.NativeElementManager;<br />
import cocktail.domElement.ImageDOMElement;<br />
import cocktail.domElement.GraphicDOMElement;<br />
import cocktail.domElement.TextDOMElement;<br />
import cocktail.domElement.DOMElement;<br />
import cocktail.keyboard.KeyboardData;<br />
[/sourcecode]</p>
<p>These classes will let you manipulate the javascript or Flash DOM seamlessly, load assets and get keyboard events. As you will see it below...</p>
<h4>The graphical Elements</h4>
<p>Here are the variables used to store the graphical objects.</p>
<p>[sourcecode language="actionscript3"]<br />
var mArena:GraphicDOMElement;<br />
var mBits:ImageDOMElement;<br />
[/sourcecode]</p>
<p>Note the GraphicDOMElement, this is the one to which we will draw. And we will use the ImageDOMElement as a source, since it will contain this png image:</p>
<p><a href="https://www.silexlabs.org/129346/the-blog/cocktail-for-an-open-bar-community/attachment/tiles/" rel="attachment wp-att-129703"><img class="alignnone" title="tile for the sky game" src="{{ site.baseurl }}/assets/tiles.png" alt="" width="199" height="64" /></a></p>
<p>And here is the code where the GraphicDOMElement is initialized, before we can draw into it:</p>
<p>[sourcecode language="actionscript3"]<br />
//the abstract gaphic dom object is instantiated and<br />
//its dimensions are set. It will be used as a cross-platform<br />
//drawing surface<br />
mArena = new GraphicDOMElement();<br />
mArena.width = 640;<br />
mArena.height = 480;</p>
<p>//it is attached to the root dom object, the higher object<br />
//in the DOM tree<br />
rootDOMElement.addChild(mArena);<br />
[/sourcecode]</p>
<p><span class="Apple-style-span" style="font-weight: normal; font-size: 13px;">And here is the "magic", how to draw in a DOMElement, which means draw in a canvas or in a Sprite depending on the target:</span></p>
<p>[sourcecode language="actionscript3"]<br />
//use the drawImage method of the GraphicDOMElement<br />
//to copy pixels onto a surface<br />
mArena.drawImage(mBits, mPoint, mRect);<br />
[/sourcecode]</p>
<h2>Credits</h2>
<p>Special Thanks</p>
<ul>
<li><a href="http://gm2d.com/">GM2D</a> for <a href="http://gm2d.com/2009/02/simple-flash-game-in-haxe/">the classic little ski game</a> tutorial</li>
<li>Yannick for the code</li>
<li><a href="http://superwup.com/">Pol</a> for the design</li>
<li><a href="http://the.webapp.cat/">lexa</a> for the rest :)</li>
</ul>
