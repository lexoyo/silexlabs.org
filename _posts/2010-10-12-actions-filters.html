---
layout: post
title: Actions & Filters
date: 2010-10-12 15:15:47.000000000 +02:00
type: post
parent_id: '0'
published: true
password: ''
status: publish
categories:
- Blog Silex
- The Blog
tags:
- dev
- Haxe
- hooks
meta:
  color: red
  _wp_old_slug: ''
author:
  login: lexa
  email: lexoyo@yahoo.com
  display_name: lexa
  first_name: lexa
  last_name: ''
permalink: "/actions-filters/"
---
<p><strong>This post is aimed at developers.</strong><br />
As you certainly know, in order to unify development of SILEX, we are moving from a solution using JavaScript, ActionScript2, ActionScript3 and PHP to a solution using haXe targetting all these platforms.<br />
Since haXe provides no way of using references in PHP, we have to make some changes in our Hook system. In order to do that, we are now introducing a new system : Actions and Filters.<br />
The following aims at explaining how this new system will work and how it will be articulated.</p>
<p><!--more--></p>
<h1>The issue</h1>
<p>The hook system in SILEX works pretty well. The problem comes from the move to the haXe language.</p>
<p>The fact is that the hook system makes an extensive use of references (giving parameters as references) to allow a hook to modify a parameter so that a new value may be used in place when resuming to normal flow.</p>
<p>Although this system was working with pure PHP it is unusable in haXe because haXe does not support references.</p>
<h1>The solution</h1>
<p>We are going to implement something thatâ€™s close to WordPress Actions &amp; Filters system.</p>
<h2>Actions</h2>
<p>Actions will call registered handlers. These handlers will be able to do whatever they want to do (such as displaying a prompt to the user or logging something).<br />
Also, in the future, we may add the possibility for action handlers to prevent the action from taking place.</p>
<p>Filters</p>
<p>Filters are to be used in order to modify some data. Those data could be strings or any other type of object. The filter is simply called with a set of parameters and returns the new value for the object to be filtered.</p>
<p>Filter calls are chained which means that the third filter gets the modified value from the first and second filters.</p>
<h2>Several filter handlers</h2>
<p>When several filter handlers are registered on the same filter, the first one gets the initial value and returns a new value. This new value is then passed to the second filter that returns a second new value. This second value gets passed to the third filter and so on. The applyFilter function (see below) will then only return the new value from the last filter.</p>
<h1>Implementation</h1>
<p>The implementation is pretty straightforward but there are something to account for before doing it.</p>
<p>There are three cases:</p>
<ol>
<li>An action/filter is dispatched 	from JS, it has to be relayed to the AS side.</li>
<li>An action/filter is dispatched 	from AS, it has to be relayed to the JS side.</li>
<li>An action/filter is dispatched 	from PHP, it will stay in PHP.</li>
</ol>
<p>So, to sum up things: when an action/filter is dispatched on the client side, it stays on the client side (but is dispatched across all platforms used on this side). When an action/filter is dispatched on the server side, it stays on the server side.</p>
<h3>At the moment</h3>
<p>At the moment, we will stick to writing a class that would work on all platforms but without any communication between platforms. This will make it easier and will fit our needs.  So, right now, an action/filter dispatched in JS will stay in JS and one dispatched in AS will stay in AS.</p>
<p>Also, note that we do not plan to support communication between the client and the server sides.</p>
<h1>The class</h1>
<p>Only one class will be used: it will manage the dispatching of actions and filters. Here is the proposed signature for this class:</p>
<h2>HookManager</h2>
<p>This class would be responsible of registering handlers for actions and dispatching them.</p>
<h3>addActionHandler</h3>
<p>Action Handlers would take 1 parameter:</p>
<ul>
<li>An array of parameters.</li>
</ul>
<p>Handlers return either true or false (false to prevent the action from taking place if this is implemented in the future).</p>
<p>The addActionHandler function takes the following parameters:</p>
<ul>
<li>actionName the name of the action to link the handler with.</li>
<li>handler the handler to be added. If you are using this function from haXe, you can pass a function reference as you would normally do. If you are in PHP, you can pass your PHP function as you would do it with <a href="http://fr.php.net/manual/en/function.call-user-func-array.php">call_user_func_array</a>.</li>
</ul>
<h3>applyAction</h3>
<p>This method calls all action handlers who are registered to the specified action.</p>
<ul>
<li>action is a string specifying the action.</li>
<li>parameters is an array of 	parameters that will be passed to the action handlers. You can either pass a PHP array or an haXe array.</li>
</ul>
<p>It returns true if the action took place or false if it was cancelled (if preventing action is to be implemented).</p>
<h3>removeAction</h3>
<p>This function removes the action handler given as parameters from the list of handlers to be called for the action.</p>
<h2>addFilterHandler</h2>
<p>This function allows one to register an handler for a filter.</p>
<p>Handlers take one parameter, which is the value to filter and return the value once filtered.</p>
<p>This function takes two arguments:</p>
<ul>
<li>filter is a string specifying the filter to link with.</li>
<li>handler is the handler to be added. Same remark than for addActionHandler.</li>
</ul>
<h3>applyFilter</h3>
<p>This function takes the name of the filter to be dispatched and the value to be filtered as parameters and returns the value once filtered by all filters.</p>
<h3>removeFilter</h3>
<p>This function removes the filter handler from the list of filter handlers to be called for the specified filter.</p>
